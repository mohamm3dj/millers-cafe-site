<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">

  <!-- Mobile sizing -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- App-like behaviour -->
  <meta name="theme-color" content="#0b0b0c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="format-detection" content="telephone=no">

  <title>Millers Café</title>
  <meta name="description" content="Millers Café — menu, collection, delivery and bookings.">

  <!-- PWA -->
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="apple-touch-icon" href="./icon-192.png">

  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <div id="intro" class="intro" aria-hidden="true">
    <div class="introStage">
      <div class="introCupScene">
        <div class="introSteam introSteam1"></div>
        <div class="introSteam introSteam2"></div>
        <div class="introSteam introSteam3"></div>
        <div class="introCup">
          <div class="introCoffee"></div>
        </div>
        <div class="introHandle"></div>
        <div class="introSaucer"></div>
      </div>
      <div class="introLogoWrap">
        <img class="introLogo" src="./assets/millers-logo.svg" alt="">
      </div>
    </div>
    <div class="introWordmark">Millers Cafe</div>
  </div>

  <main>

    <!-- HEADER -->
    <div class="header glassHero">
      <div class="logo">
        <img class="logoImg" src="./assets/millers-logo.svg" alt="Millers Cafe logo">
      </div>
      <h1>Millers Café</h1>
      <p class="subtitle heroSub">Fresh flavours, warm service, and your 2026 favourites.</p>
      <div id="heroStatus" class="heroStatus isClosed" role="status" aria-live="polite">
        <span class="statusDot" aria-hidden="true"></span>
        <span id="heroStatusText">Checking opening status...</span>
      </div>
      <p id="heroHours" class="heroHours">Today: 12:00-17:00</p>
      <p class="heroMeta">55 Brigsley Road, Waltham, Grimsby DN37 0JZ</p>
    </div>

    <!-- BUTTON GRID -->
    <div class="grid homeGrid">

      <a class="tile homeTile homeTileMenu" href="./menu/">
        <div class="homeTileIcon" aria-hidden="true">
          <svg viewBox="0 0 24 24">
            <path d="M4 6.5c2.5-1.3 5.5-1.3 8 0v11c-2.5-1.3-5.5-1.3-8 0v-11Z"></path>
            <path d="M20 6.5c-2.5-1.3-5.5-1.3-8 0v11c2.5-1.3 5.5-1.3 8 0v-11Z"></path>
          </svg>
        </div>
        <div class="tileTitle">Menu</div>
        <div class="tileSub">Explore the full 2026 menu in one tap</div>
        <div class="tileCta">View Menu</div>
      </a>

      <a class="tile homeTile homeTileCollection" href="./collection/">
        <div class="homeTileIcon" aria-hidden="true">
          <svg viewBox="0 0 24 24">
            <path d="M7 8.5h10l.9 10H6.1l.9-10Z"></path>
            <path d="M9 8.5V7a3 3 0 0 1 6 0v1.5"></path>
          </svg>
        </div>
        <div class="tileTitle">Collection</div>
        <div class="tileSub">Place your pickup order quickly</div>
        <div class="tileCta">Start Collection</div>
      </a>

      <a class="tile homeTile homeTileDelivery" href="./delivery/">
        <div class="homeTileIcon" aria-hidden="true">
          <svg viewBox="0 0 24 24">
            <path d="M4 14V9h9v5"></path>
            <path d="M13 11h3l3 3v5"></path>
            <circle cx="7" cy="19" r="2"></circle>
            <circle cx="18" cy="19" r="2"></circle>
          </svg>
        </div>
        <div class="tileTitle">Delivery</div>
        <div class="tileSub">Order delivery to your address now</div>
        <div class="tileCta">Start Delivery</div>
      </a>

      <a class="tile homeTile homeTileBookings" href="./bookings/">
        <div class="homeTileIcon" aria-hidden="true">
          <svg viewBox="0 0 24 24">
            <rect x="5.5" y="4.5" width="13" height="15" rx="2.5"></rect>
            <path d="M9 3.8v2.8M15 3.8v2.8M6 9.5h12M9 14l2 2 4-4"></path>
          </svg>
        </div>
        <div class="tileTitle">Bookings</div>
        <div class="tileSub">Reserve your table in under a minute</div>
        <div class="tileCta">Book a Table</div>
      </a>

      <a
        class="tile homeTile homeTileLocation"
        href="https://www.google.com/maps/dir/?api=1&destination=Millers%20Restaurant%2C%2055%20Brigsley%20Road%2C%20Waltham%2C%20Grimsby%20DN37%200JZ"
        target="_blank"
        rel="noopener noreferrer"
      >
        <div class="homeTileIcon" aria-hidden="true">
          <svg viewBox="0 0 24 24">
            <path d="M12 20.5s-5-4.6-5-8.7a5 5 0 1 1 10 0c0 4.1-5 8.7-5 8.7Z"></path>
            <circle cx="12" cy="11.2" r="2"></circle>
          </svg>
        </div>
        <div class="tileTitle">Find Us</div>
        <div class="tileSub">Open turn-by-turn directions instantly</div>
        <div class="tileCta">Get Directions</div>
      </a>

      <div
        id="contactFlipTile"
        class="tile homeTile homeTileContact homeFlipTile"
        role="button"
        tabindex="0"
        aria-label="Contact Us card. Activate to show contact details."
        aria-expanded="false"
      >
        <div class="homeFlipInner">
          <div class="homeFlipFace homeFlipFront">
            <div class="homeTileIcon" aria-hidden="true">
              <svg viewBox="0 0 24 24">
                <path d="M6.2 5.8h3.1l1.1 3.1-2.1 1.5a12 12 0 0 0 5.2 5.2l1.5-2.1 3.1 1.1v3.1c0 .8-.7 1.4-1.5 1.4-6.4 0-11.7-5.2-11.7-11.7 0-.8.6-1.5 1.3-1.5Z"></path>
              </svg>
            </div>
            <div class="tileTitle">Contact Us</div>
            <div class="tileSub">Tap to reveal phone and email</div>
            <div class="tileCta">Show Details</div>
          </div>

          <div class="homeFlipFace homeFlipBack" id="contactFlipBack">
            <div class="tileTitle">Contact Us</div>
            <a class="flipLink" href="tel:+441472828600">01472 828600 / 823030</a>
            <a class="flipLink" href="mailto:hello@millers.cafe">hello@millers.cafe</a>
            <button class="flipBackBtn" type="button">Back</button>
          </div>
        </div>
      </div>

    </div>

    <!-- FOOTER -->
    <div class="footer">
      <a href="mailto:hello@millers.cafe" style="color:inherit;">
        hello@millers.cafe
      </a>
    </div>

  </main>

  <script src="./page-transitions.js"></script>
  <script>
    const businessTimezone = "Europe/London";
    const weeklyHours = {
      0: [["12:00", "17:00"]],
      1: [],
      2: [["12:00", "17:00"]],
      3: [["12:00", "17:00"]],
      4: [["12:00", "17:00"]],
      5: [["12:00", "17:00"]],
      6: [["12:00", "17:00"]]
    };

    function toMinutes(clock) {
      const [hours, minutes] = clock.split(":").map(Number);
      return (hours * 60) + minutes;
    }

    function formatDayHours(windows) {
      if (!windows.length) return "Closed";
      return windows.map(([start, end]) => `${start}-${end}`).join(" / ");
    }

    function getNowInBusinessTimezone() {
      const parts = new Intl.DateTimeFormat("en-GB", {
        timeZone: businessTimezone,
        weekday: "short",
        hour: "2-digit",
        minute: "2-digit",
        hour12: false
      }).formatToParts(new Date());

      const weekday = parts.find((part) => part.type === "weekday")?.value || "Mon";
      const hour = Number(parts.find((part) => part.type === "hour")?.value || "0");
      const minute = Number(parts.find((part) => part.type === "minute")?.value || "0");
      const dayMap = { Sun: 0, Mon: 1, Tue: 2, Wed: 3, Thu: 4, Fri: 5, Sat: 6 };

      return {
        dayIndex: dayMap[weekday] ?? 1,
        minutesNow: (hour * 60) + minute
      };
    }

    function updateOpeningStatus() {
      const statusWrap = document.getElementById("heroStatus");
      const statusText = document.getElementById("heroStatusText");
      const heroHours = document.getElementById("heroHours");
      if (!statusWrap || !statusText || !heroHours) return;

      const { dayIndex, minutesNow } = getNowInBusinessTimezone();
      const windows = weeklyHours[dayIndex] || [];
      const isOpen = windows.some(([start, end]) => {
        const startMin = toMinutes(start);
        const endMin = toMinutes(end);
        return minutesNow >= startMin && minutesNow < endMin;
      });

      statusWrap.classList.toggle("isOpen", isOpen);
      statusWrap.classList.toggle("isClosed", !isOpen);
      statusText.textContent = isOpen ? "Open now" : "Closed now";
      heroHours.textContent = `Today: ${formatDayHours(windows)}`;
    }

    const intro = document.getElementById("intro");
    if (intro) {
      const reducedMotion = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
      let internalNav = false;
      try {
        internalNav = window.sessionStorage.getItem("pt-internal-nav") === "1";
        if (internalNav) window.sessionStorage.removeItem("pt-internal-nav");
      } catch (e) {
        internalNav = false;
      }

      if (reducedMotion || internalNav) {
        intro.remove();
      } else {
        window.addEventListener("load", () => {
          setTimeout(() => intro.classList.add("introDone"), 2400);
          setTimeout(() => intro.remove(), 3200);
        });
      }
    }

    updateOpeningStatus();
    window.setInterval(updateOpeningStatus, 60 * 1000);

    const contactFlipTile = document.getElementById("contactFlipTile");
    if (contactFlipTile) {
      const setFlipped = (flipped) => {
        contactFlipTile.classList.toggle("isFlipped", flipped);
        contactFlipTile.setAttribute("aria-expanded", flipped ? "true" : "false");
      };

      contactFlipTile.addEventListener("click", (event) => {
        const target = event.target;
        if (!(target instanceof Element)) return;

        if (target.closest(".flipLink")) {
          return;
        }

        if (target.closest(".flipBackBtn")) {
          event.preventDefault();
          setFlipped(false);
          return;
        }

        setFlipped(!contactFlipTile.classList.contains("isFlipped"));
      });

      contactFlipTile.addEventListener("keydown", (event) => {
        if (event.key === "Enter" || event.key === " ") {
          event.preventDefault();
          setFlipped(!contactFlipTile.classList.contains("isFlipped"));
        } else if (event.key === "Escape") {
          setFlipped(false);
        }
      });

      document.addEventListener("click", (event) => {
        if (!(event.target instanceof Element)) return;
        if (!contactFlipTile.contains(event.target)) {
          setFlipped(false);
        }
      });
    }

    // Register Service Worker (only works properly once the site is hosted on HTTPS)
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("./sw.js").catch(() => {});
      });
    }
  </script>

</body>
</html>
